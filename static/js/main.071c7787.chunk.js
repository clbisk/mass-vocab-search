(this["webpackJsonpvocab-search-app"]=this["webpackJsonpvocab-search-app"]||[]).push([[0],{19:function(e,t,a){},45:function(e){e.exports=JSON.parse('{"key":"dict.1.1.20210530T134803Z.eb14b9d158dd0367.91c5634596c93b8bc100475dc9e8af1f22972a96"}')},46:function(e){e.exports=JSON.parse('{"key":"1be91e33-f360-859c-bb8b-93d41b745d6c:fx"}')},49:function(e,t,a){e.exports=a(88)},54:function(e,t,a){},55:function(e,t,a){},56:function(e,t,a){},62:function(e,t,a){},84:function(e,t,a){},85:function(e,t,a){},88:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(11),s=a.n(i),c=(a(54),a(19),a(5)),o=a(6),l=a(8),u=a(7),d=a(18),m=(a(55),function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"tracau-banner"},r.a.createElement("a",{href:"https://tracau.vn"},r.a.createElement("img",{src:"https://tracau.vn/assets/img/api/banner_white.png",alt:"Powered by tra c\xe2u"})))}}]),a}(r.a.Component)),h=(a(56),a(42)),p=a(43),f=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).state={text:""},e}return Object(o.a)(a,[{key:"detectHotkeySubmit",value:function(e,t){e.shiftKey&&"Enter"===e.key&&this.props.submitSearch(t)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"InputText"},r.a.createElement("div",{className:"main-content"},r.a.createElement("div",null,"Enter text: "),r.a.createElement("div",{className:"upper-flex",onKeyPress:function(t){return e.detectHotkeySubmit(t,e.state.text)}},r.a.createElement("textarea",{className:"big-textbox",value:this.state.text,onChange:function(t){return e.setState({text:t.target.value})}}),r.a.createElement(h.a,{icon:p.a,onClick:function(t){return e.props.submitSearch(e.state.text)}}))),r.a.createElement(m,null))}}]),a}(r.a.Component),v=a(24),g=a(17),x=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"render",value:function(){return this.props.defnsList[0].startsWith("See ")?this.defnsList=this.props.defnsList.slice(1):this.defnsList=this.props.defnsList,r.a.createElement("div",{className:"Definition"},r.a.createElement("ol",null,this.defnsList.map((function(e){return r.a.createElement("li",null,e)}))))}}]),a}(r.a.Component),y=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"render",value:function(){var e=r.a.createElement(g.a,{id:this.props.word},r.a.createElement(g.a.Title,{as:"h3"},this.props.word),r.a.createElement(g.a.Content,null,r.a.createElement(x,{defnsList:this.props.defn})));return r.a.createElement("div",{className:"DefinedWord"},r.a.createElement(v.a,{key:this.props.word,placement:"top",overlay:e},r.a.createElement("div",null,this.props.word)))}}]),a}(r.a.Component),b=(a(62),a(20)),E=a.n(b),O=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).state={isLoaded:!1,searchResults:{}},e}return Object(o.a)(a,[{key:"search",value:function(e){var t=this,a=e.split(/[ X\n]/),n={},r=a.map((function(e,r){return t.searchCompoundWord(a,r).then((function(t){if(t&&t.length>0&&!t[0].startsWith("See "))return n[e+" "+a[r+1]]=t,Promise.resolve()}))}));return Promise.all(r).then((function(){var e=Object.assign({},n);console.log("compound definitions:",e);var r=a.map((function(r,i){var s=a[i-1]+" "+r,c=r+" "+a[i+1];return s in n||c in n?Promise.resolve():t.tracauSearch(r).then((function(t){return t&&t.length>0&&(e[r]=t),Promise.resolve()}))}));return Promise.all(r).then(e)}))}},{key:"searchCompoundWord",value:function(e,t){return e.length>t+1?this.tracauSearch(e[t]+" "+e[t+1]):Promise.resolve()}},{key:"tracauSearch",value:function(e){var t=e.trim().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"");return E.a.get("https://api.tracau.vn/"+k+"/s/"+t+"/vi").then((function(e){if(e.data.tratu.length<=0)return!1;var t=e.data.tratu[0].fields.fulltext,a=t.indexOf('<article id="dict_vv" data-tab-name="Vi\u1ec7t - Anh"'),n=t.slice(a),r=n.indexOf("</article>"),i='<table id="definition_T_ve_id" border="0">',s=(n=n.slice(0,r)).indexOf(i)+i.length,c=n.slice(s),o=c.indexOf("</table>"),l=(c=c.slice(0,o)).split('<td id="I_C"><font color="#999">\u25a0</font></td><td id="C_C" colspan="2">'),u=[];return l.slice(1).forEach((function(e){var t=e.slice(0,e.indexOf("</td>")),a=t.indexOf("</font>");(t.startsWith('Xem <font color="#1371BB">')||t.startsWith('xem <font color="#1371BB">'))&&(t="See "+t.slice('Xem <font color="#1371BB">'.length,a)),u.push(t)})),u}))}},{key:"componentDidMount",value:function(){var e=this;this.search(this.props.text).then((function(t){console.log("search results",t),e.setState({isLoaded:!0,searchResults:t})}))}},{key:"render",value:function(){var e=this,t=r.a.createElement("div",{className:"footer"},r.a.createElement("div",{className:"submit-search"},r.a.createElement("button",{onClick:this.props.returnToSearch},"Search again")),r.a.createElement(m,null));return""===this.props.text?r.a.createElement("div",{className:"SearchedText"},r.a.createElement("div",{className:"text-display"},r.a.createElement("div",{className:"vertical-centered"},r.a.createElement("div",null,"Oops! Looks like no text was input. Would you like to search again?"))),t):this.state.isLoaded?r.a.createElement("div",{className:"SearchedText"},r.a.createElement("div",{className:"text-display"},r.a.createElement("div",{className:"vertical-centered"},r.a.createElement("div",{className:"words-and-definitions"},this.props.text.split(/[ X\n]/).map((function(t,a){if(-1!==a){var n=t+" "+e.props.text.split(/[ X\n]/)[a+1];if(n in e.state.searchResults){var i=e.state.searchResults[n];return r.a.createElement(y,{word:n,defn:i,key:a})}if(t in e.state.searchResults){var s=e.state.searchResults[t];return r.a.createElement(y,{word:t,defn:s,key:a})}return r.a.createElement("div",{className:"definition-not-found",key:a},t)}}))))),t):r.a.createElement("div",{className:"SearchedText"},r.a.createElement("div",{className:"text-display"},r.a.createElement("div",{className:"vertical-centered"},"loading...")),t)}}]),a}(r.a.Component),k="WBBcwnwQpV89",j=O,w=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).state={searched:!1,searchedText:""},e.toggleSearch=e.toggleSearch.bind(Object(d.a)(e)),e}return Object(o.a)(a,[{key:"toggleSearch",value:function(e){this.setState((function(t){return{searched:!t.searched,searchedText:e}}))}},{key:"render",value:function(){var e=this;return this.state.searched?r.a.createElement("div",{className:"TextInput"},r.a.createElement(j,{text:this.state.searchedText,returnToSearch:function(t){return e.toggleSearch("")}})):r.a.createElement("div",{className:"TextInput"},r.a.createElement("header",{className:"App-header"},r.a.createElement(f,{submitSearch:this.toggleSearch})))}}]),a}(r.a.Component),N=a(16),S=a.n(N),I=a(22),C=a(44),L=a.n(C),T=(a(84),function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.call(this)}return Object(o.a)(a,[{key:"renderDefinition",value:function(e){if(e.definition.def&&e.definition.def.length>0){var t=e.definition.def[0].tr.map((function(e){return r.a.createElement("li",null,e.text)}));return r.a.createElement("ol",null,t)}if(e.definition.translations.length>0){var a=e.definition.translations.map((function(e){return r.a.createElement("li",null,e.text)}));return r.a.createElement("ol",null,a)}return"no definition found :("}},{key:"detectImageRotation",value:function(){var e=this.props.fullText.pages[0].blocks,t=e[0].paragraphs[0].words[0],a=e[0].paragraphs[0].words[1]?e[0].paragraphs[0].words[1]:e[0].paragraphs[1].words[0]?e[0].paragraphs[1].words[0]:e[1].paragraphs[0].words[0],n=t.boundingBox.vertices,r=a.boundingBox.vertices,i=Math.min(n[0].y,n[1].y,n[2].y,n[3].y),s=Math.min(n[0].x,n[1].x,n[2].x,n[3].x),c=Math.max(n[0].y,n[1].y,n[2].y,n[3].y),o=Math.max(n[0].x,n[1].x,n[2].x,n[3].x),l=Math.min(r[0].y,r[1].y,r[2].y,r[3].y),u=Math.min(r[0].x,r[1].x,r[2].x,r[3].x),d=Math.max(r[0].y,r[1].y,r[2].y,r[3].y),m=(Math.max(r[0].x,r[1].x,r[2].x,r[3].x),c-i);return u>s+(o-s)?"right side up":(console.log("the image was flipped at some point during detection and I simply don't know why :/"),l>i+m?"rotated left, flipped":d<c-m?"rotated left":void 0)}},{key:"renderDetectionsOnImage",value:function(){var e=this,t=this.detectImageRotation();return this.props.detections.map((function(a,n){var i=a.boundingPoly.vertices[0],s=a.boundingPoly.vertices[1],c=a.boundingPoly.vertices[3],o=a.boundingPoly.vertices[2],l=Math.min(i.y,s.y,c.y,o.y),u=Math.min(i.x,s.x,c.x,o.x),d=Math.max(i.y,s.y,c.y,o.y),m=Math.max(i.x,s.x,c.x,o.x),h=l,p=u,f=d-l,x=m-u;"right side up"!==t&&"rotated left"===t&&(h=u,p=e.props.imageWidth-d,f=m-u,x=d-l);var y=r.a.createElement(g.a,{className:"dynamic-text-size",id:a.description,key:a.description+l+"-popover"},r.a.createElement(g.a.Title,{className:"large-dynamic-text-size"},a.description),r.a.createElement(g.a.Content,null,e.renderDefinition(a)));return r.a.createElement("div",{key:a.description+l},r.a.createElement(v.a,{key:a.description,placement:"top",overlay:y},r.a.createElement("div",{className:"text-overlay",style:{top:h,left:p,height:f,width:x}},a.description)))}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"ImageDetections"},r.a.createElement("div",{className:"img-box"},this.renderDetectionsOnImage(),r.a.createElement("img",{src:URL.createObjectURL(this.props.images[0]),width:this.props.imageWidth,height:this.props.imageHeight})))}}]),a}(r.a.Component)),P=(a(85),a(45)),_=a(46),D=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).state={img_files:null,img_buffers:null,imagesInput:!1,textDetections:null,definedDetections:null,detectionsLoaded:!1,imageWidth:0,imageHeight:0},e.changeImage=e.changeImage.bind(Object(d.a)(e)),e.setImageProps=e.setImageProps.bind(Object(d.a)(e)),e}return Object(o.a)(a,[{key:"changeImage",value:function(e,t){this.setState({img_files:e,img_type:".jpg",imagesInput:!0},this.parseFiles)}},{key:"parseFiles",value:function(){var e=Object(I.a)(S.a.mark((function e(){var t,a=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.img_files.map((function(e){return a.parseFile(e)})),Promise.all(t).then((function(e){a.setState({img_buffers:e},a.getOCR)}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setImageProps",value:function(e,t){this.setState({imageWidth:e,imageHeight:t})}},{key:"parseFile",value:function(){var e=Object(I.a)(S.a.mark((function e(t){var a;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.setImageProps,e.abrupt("return",new Promise((function(e){var n=new FileReader;n.addEventListener("load",(function(t){var r=new Image;r.src=t.target.result,r.onload=function(){a(this.width,this.height)},e(n.result)}),!1),n.readAsDataURL(t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOCR",value:function(){var e=Object(I.a)(S.a.mark((function e(){var t=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",E.a.post("https://us-east4-true-bit-315318.cloudfunctions.net/documentTextDetection",{img:this.state.img_buffers[0]}).then((function(e){t.setState({textDetections:e.data.textAnnotations,fullText:e.data.fullTextAnnotation},t.getDefinitions)})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDefinitions",value:function(){var e=Object(I.a)(S.a.mark((function e(){var t,a=this;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.textDetections.map((function(e,t){if(0!==t){var a=e.description.replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"").toLowerCase();if(0!==a.length)return E.a.get("https://dictionary.yandex.net/api/v1/dicservice.json/lookup?key=".concat(P.key,"&lang=ru-en&text=").concat(a)).then((function(t){return Object.assign(e,{definition:t.data}),e}))}})),Promise.all(t).then((function(e){var t=e.map((function(e){if(void 0!==e){if(void 0===e.def||0===e.def.length){var t=e.description.replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"").toLowerCase();return E.a.get("https://api-free.deepl.com/v2/translate?auth_key=".concat(_.key,"&text=").concat(t,"&target_lang=EN")).then((function(t){return Object.assign(e,{definition:t.data}),e}))}return e}}));Promise.all(t).then((function(e){a.setState({definedDetections:e.filter((function(e){return void 0!==e})),detectionsLoaded:!0})}))}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.detectionsLoaded?r.a.createElement("div",{className:"ImageInput"},r.a.createElement(T,{detections:this.state.definedDetections,images:this.state.img_files,imageWidth:this.state.imageWidth,imageHeight:this.state.imageHeight,fullText:this.state.fullText})):this.state.imagesInput?r.a.createElement("div",{className:"ImageInput"},"Loading image text..."):r.a.createElement("div",{className:"ImageInput"},r.a.createElement(L.a,{onChange:this.changeImage,imgExtension:[".jpg",".png",".pdf",".tif",".gif",".bmp"]}))}}]),a}(r.a.Component),W=a(47),M=a(4),R=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(W.a,null,r.a.createElement(M.c,null,r.a.createElement(M.a,{path:"/text",component:w}),r.a.createElement(M.a,{path:"/img",component:D}),r.a.createElement(M.a,{exact:!0,path:"/",component:w}))))}}]),a}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(R,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[49,1,2]]]);
//# sourceMappingURL=main.071c7787.chunk.js.map